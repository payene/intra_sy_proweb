{% extends 'LooninsSuiviBundle::layout.html.twig' %}

{% block legend %}
    Index des statistiques 
        <button style="float: right;margin-left: 5px;" class="btn btn-primary" id="open-stat" >
            Nouvelle entr&eacute;e statistique
        </button>
        <a target="blank" class="btn btn-alert" style="float:right;border-bottom: solid 1px silver;" href="{{ path('stat_export') }}"> Exporter en csv </a> 
         <br style="clear:both;">
{% endblock %}


{% block panel_head %}

{% endblock %}

{% block body %}
    {% include  'LooninsSuiviBundle:Stat:search_form.html.twig' %}
         
    

         {% if cumul is defined and cumul is not null %}
                
                <style type="text/css">
                    
                    td{
                        vertical-align: middle;
                    }
                </style>
                <table class="table table-striped  table-hover" >
                    <thead class="alert alert-info">
                        <tr>
                            <th style="vertical-align: top;text-align: center;" colspan="2"> Du 
                                <b> {{ busDtDebut|date('d/m/Y') }} </b>
                                Au <b> {{ busDtFin|date('d/m/Y') }} </b>
                            </th>

                            <th style="vertical-align: bottom;text-align: center;" colspan="4">
                                 <b> {{ table|upper }}  </b>
                            </th>

                            <th style="vertical-align: bottom;text-align: center;" colspan="3">
                                 {{ animatrice }}
                            </th>
                        </tr>
                        <tr>
                            <th>Login  </th>
                            <th>Messages/heure</th>
                            <th>Total</th>
                            <th>Progrmm&eacute;</th>
                            <th>R&eacute;eel</th>
                            <th> Prime </th>
                            <th>Message/conv </th>
                            <th> Details  </th>
                        </tr>
                    </thead>

                    <tbody>
                        {% for c in cumul %}
                            <tr style="height:15px;">
                                <td style="padding:0px;vertical-align:middle"> {{ c.SS.animatrice }} </td>
                                <td style="padding:0px;vertical-align:middle"> 
                                {% if c.RL > 0 %}
                                    {{ ((c.TT/c.RL) * 3600)|round(2, 'common') }} 
                                {% else %}
                                    0
                                {% endif %}
                                </td>
                                <td style="padding:0px;vertical-align:middle"> {{ c.TT }} </td>
                                <td style="padding:0px;vertical-align:middle">
                                    
                                    {% set s = c.PRG  %}
                                    <!-- //Get whole hours -->
                                    
                                    {% set h = (s/3600)|round(0, 'floor')  %}

                                    <!-- //Get remaining minutes -->
                                    {% set s = s- (h*3600) %}  
                                    
                                    {% set m = (s/60)|round(0, 'floor')  %}

                                    {% set s = (s- (m*60))|round(0, 'floor') %}

                                        {{ (h <10) ? '0'~ h : h }}:{{(m < 10) ? '0'~ m : m}}:{{ (s<10) ? '0'~s:s  }}
                                        

                                </td>


                                    {% set cumulReel = (c.TT/c.AVG_MPH)|round(2, 'floor') %}
                                    
                                    {% if c.RL < ((7/8) * c.PRG) %}
                                        <td class="alert alert-danger" style="padding:0;background-color:  rgba(185, 74, 72, 0.77);color: white;">
                                    {% else %}
                                        <td class="alert alert-danger" style="padding:0;background-color: rgba(70, 136, 71, 0.77);color: white;">
                                    {% endif %}
                                    

                                    {% set s = c.RL  %}
                                    <!-- //Get whole hours -->
                                    
                                    {% set h = (s/3600)|round(0, 'floor')  %}

                                    <!-- //Get remaining minutes -->
                                    {% set s = s- (h*3600) %}  
                                    
                                    {% set m = (s/60)|round(0, 'floor')  %}

                                    {% set s = (s- (m*60))|round(0, 'floor') %}

                                    {{ (h <10) ? '0'~ h : h }}:{{(m < 10) ? '0'~ m : m}}:{{ (s<10) ? '0'~s:s  }}
                                       
                                </td>
                                <td style="padding:0px;vertical-align:middle"> {{ c.SUM_PRM }} </td>
                                <td style="padding:0px;vertical-align:middle"> {{ c.MPC}} </td>
                                <td style="padding:0px;vertical-align:middle"> 
                                    <a target="_blank" href="{{ path('stat_cumul_one', {'busdt1': busDtDebut|date('Y-m-d'), 'busdt2':busDtFin|date('Y-m-d'), 'type':c.SS.type.id,'animatrice':c.SS.animatrice.id }) }}">
                                        Voir plus
                                    </a>
                                    
                                </td>
                            </tr>
                        {% endfor  %}
                    </tbody>

                  
                </table>
        {% endif %}

          <div id="stat-modal" tabindex="-1">
            <div class="modal" >
                <div class="modal-header">
                    <h3 id="myModalLabel">Nouvelle entr&eacute;e de statistique</h3>
                </div>
                <div class="modal-body">
                    <form class="" action="{{ path('stat') }}" method="post">
                       
                        <div class="form-row" style="display: inline;float: left;">
                            {{ form_label(form.dateStat, "Date statistique") }}
                                <div class="controls input-append date form_date" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                                    {# Génération de l'input. #}
                                    {{ form_widget(form.dateStat) }}
                                    <span class="add-on"><i class="icon-remove"></i></span>
                                    <span class="add-on"><i class="icon-th"></i></span>
                                </div>
                        </div>                    

                        <div  class="form-row"  style="display: inline;float: right;">
                            {{ form_label(form.type, "Table Statistique") }}
                            {{ form_errors(form.type, {'attr': {'class': 'alert alert-error'} }) }}
                            {# Génération de l'input. #}
                            {{ form_widget(form.type) }} 
                        </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success" >
                        Commencer la saisie des statistiques
                    </button>
                    <button id="close-stat-modal" class="btn btn-warning" type="reset">Annuler</button>
                </div>
                 {{ form_rest(form) }}
                    </form>
            </div>
        </div>
{% endblock %}
